{"version":3,"sources":["scrollview/Bar.js"],"names":["dom","cx","ScrollViewBar","props","removeStateShow","bind","onBarMouseDown","onMouseDown","onMouseUp","onMouseMove","state","componentDidMount","positionThumb","shouldComponentUpdate","nextProps","Math","abs","position","addClass","refs","main","componentDidUpdate","componentWillUnmount","clearTimer","thumb","direction","thumbSize","isVertical","axis","barSize","style","round","getMousePosition","e","pageY","clientY","pageX","clientX","timer","clearTimeout","setTimeout","removeClass","target","me","mousePos","getPosition","pos","fireAction","preventDefault","body","document","thumbStart","parseInt","moveStart","on","window","event","moveLength","min","max","off","action","onAction","render","addVariants","build","part","displayName","propTypes","oneOf","isRequired","number","show","bool","func"],"mappings":"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","file":"Bar.js","sourcesContent":["/**\n * @file melon/ScrollViewBar\n * @author cxtom<cxtom2008@gmail.com>\n */\n\nimport React, {Component, PropTypes} from 'react';\nimport {create} from 'melon-core/classname/cxBuilder';\nimport * as dom from '../common/util/dom';\nimport {throttle} from '../common/util/fn';\n\nconst cx = create('ScrollviewBar');\n\nexport default class ScrollViewBar extends Component {\n\n    constructor(props) {\n\n        super(props);\n\n        this.removeStateShow = throttle(this.removeStateShow.bind(this), 100);\n\n        this.onBarMouseDown = this.onBarMouseDown.bind(this);\n        this.onMouseDown = this.onMouseDown.bind(this);\n        this.onMouseUp = this.onMouseUp.bind(this);\n        this.onMouseMove = this.onMouseMove.bind(this);\n\n        this.state = {};\n\n    }\n\n    componentDidMount() {\n        this.positionThumb();\n    }\n\n    shouldComponentUpdate(nextProps) {\n        if (Math.abs(nextProps.position - this.props.position) < 0.0005) {\n            return false;\n        }\n        dom.addClass(this.refs.main, 'state-show');\n        this.removeStateShow();\n        return true;\n    }\n\n    componentDidUpdate() {\n        this.positionThumb();\n    }\n\n    componentWillUnmount() {\n        this.clearTimer();\n    }\n\n    positionThumb() {\n\n        let {\n            main,\n            thumb\n        } = this.refs;\n\n        let {\n            direction,\n            position,\n            thumbSize\n        } = this.props;\n\n        let isVertical = direction === 'vertical';\n        let axis = isVertical ? 'top' : 'left';\n        this.barSize = main[isVertical ? 'offsetHeight' : 'offsetWidth'] - thumbSize - 4;\n        thumb.style[isVertical ? 'height' : 'width'] = thumbSize + 'px';\n        thumb.style[axis] = Math.round(position * this.barSize) + 'px';\n\n    }\n\n    getMousePosition(e, isVertical) {\n        if (isVertical) {\n            return e.pageY || e.clientY;\n        }\n        return e.pageX || e.clientX;\n    }\n\n    clearTimer() {\n        if (this.timer) {\n            clearTimeout(this.timer);\n        }\n    }\n\n    removeStateShow() {\n        this.clearTimer();\n        let main = this.refs.main;\n        this.timer = setTimeout(function () {\n            dom.removeClass(main, 'state-show');\n        }, 1800);\n    }\n\n    /**\n     * 点击滚动轨道触发\n     *\n     * @param  {Object} e MouseEvent\n     */\n    onBarMouseDown(e) {\n        let target = e.target;\n\n        if (target === this.refs.thumb) {\n            return;\n        }\n\n        let {\n            direction,\n            thumbSize\n        } = this.props;\n\n        let main = this.refs.main;\n\n        let me = this;\n        let isVertical = direction === 'vertical';\n        let axis = isVertical ? 'top' : 'left';\n\n        let barSize = main[isVertical ? 'offsetHeight' : 'offsetWidth'] - thumbSize - 4;\n        let mousePos = this.getMousePosition(e, isVertical) - dom.getPosition(main)[axis];\n\n        let pos = mousePos - thumbSize / 2;\n\n        pos = pos > barSize ? barSize : pos;\n        pos = pos < 0 ? 0 : pos;\n        me.fireAction('change', pos / barSize);\n\n        e.preventDefault();\n    }\n\n    onMouseDown(e) {\n        let body = document.body;\n        dom.addClass(body, 'ui-noselect');\n\n        let isVertical = this.props.direction === 'vertical';\n        let axis = isVertical ? 'top' : 'left';\n\n        this.thumbStart = parseInt(this.refs.thumb.style[axis], 10) || 0;\n        this.moveStart = this.getMousePosition(e, isVertical);\n\n        dom.on(body, 'mousemove', this.onMouseMove);\n        dom.on(body, 'mouseup', this.onMouseUp);\n\n        e.preventDefault();\n    }\n\n    onMouseMove(e) {\n\n        e = e || window.event;\n\n        let isVertical = this.props.direction === 'vertical';\n\n        let moveLength = this.getMousePosition(e, isVertical);\n        moveLength -= this.moveStart;\n\n        let pos = Math.min(this.barSize, Math.max(0, this.thumbStart + moveLength));\n        this.fireAction('change', pos / this.barSize);\n    }\n\n    onMouseUp(e) {\n        let body = document.body;\n        dom.removeClass(body, 'ui-noselect');\n        dom.off(body, 'mousemove', this.onMouseMove);\n        dom.off(body, 'mouseup', this.onMouseUp);\n        this.thumbStart = this.moveStart = 0;\n    }\n\n    fireAction(action, pos) {\n        let e = {\n            action: action,\n            position: pos,\n            target: this\n        };\n\n        let onAction = this.props.onAction;\n\n        onAction && onAction(e);\n    }\n\n    render() {\n\n        return (\n            <div\n                ref=\"main\"\n                className={cx(this.props).addVariants(this.props.direction).build()}\n                onMouseDown={this.onBarMouseDown}>\n                <div\n                    ref=\"thumb\"\n                    className={cx().part('thumb').build()}\n                    onMouseDown={this.onMouseDown} />\n            </div>\n        );\n\n    }\n\n}\n\nScrollViewBar.displayName = 'ScrollViewBar';\n\nScrollViewBar.propTypes = {\n    direction: PropTypes.oneOf(['vertical', 'horizontal']).isRequired,\n    position: PropTypes.number.isRequired,\n    thumbSize: PropTypes.number,\n    show: PropTypes.bool,\n    onAction: PropTypes.func\n};\n"]}