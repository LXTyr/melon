{"version":3,"sources":["scrollview/Bar.js"],"names":["dom","cx","ScrollViewBar","props","removeStateShow","bind","onBarMouseDown","onMouseDown","onMouseUp","onMouseMove","state","componentDidMount","positionThumb","shouldComponentUpdate","nextProps","Math","abs","position","componentWillReceiveProps","addClass","refs","main","componentDidUpdate","componentWillUnmount","clearTimer","thumb","direction","thumbSize","isVertical","axis","barSize","style","round","getMousePosition","e","pageY","clientY","pageX","clientX","timer","clearTimeout","cancel","setTimeout","removeClass","target","me","mousePos","getPosition","pos","fireAction","preventDefault","body","document","thumbStart","parseInt","moveStart","addEventListener","window","event","moveLength","min","max","removeEventListener","action","onAction","render","addVariants","build","getPartClassName","displayName","propTypes","oneOf","isRequired","number","show","bool","func"],"mappings":"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","file":"Bar.js","sourcesContent":["/**\n * @file melon/ScrollViewBar\n * @author cxtom<cxtom2008@gmail.com>\n */\n\nimport React, {Component, PropTypes} from 'react';\nimport {create} from 'melon-core/classname/cxBuilder';\nimport * as dom from '../common/util/dom';\nimport {throttle} from '../common/util/fn';\n\nconst cx = create('ScrollviewBar');\n\nexport default class ScrollViewBar extends Component {\n\n    constructor(props) {\n\n        super(props);\n\n        this.removeStateShow = throttle(this.removeStateShow.bind(this), 100);\n\n        this.onBarMouseDown = this.onBarMouseDown.bind(this);\n        this.onMouseDown = this.onMouseDown.bind(this);\n        this.onMouseUp = this.onMouseUp.bind(this);\n        this.onMouseMove = this.onMouseMove.bind(this);\n\n        this.state = {};\n\n    }\n\n    componentDidMount() {\n        this.positionThumb();\n    }\n\n    shouldComponentUpdate(nextProps) {\n        return Math.abs(nextProps.position - this.props.position) > 0.0005;\n    }\n\n    componentWillReceiveProps(nextProps) {\n\n        if (Math.abs(nextProps.position - this.props.position) > 0.0005) {\n            dom.addClass(this.refs.main, 'state-show');\n            this.removeStateShow();\n        }\n\n    }\n\n    componentDidUpdate() {\n        this.positionThumb();\n    }\n\n    componentWillUnmount() {\n        this.clearTimer();\n    }\n\n    positionThumb() {\n\n        let {\n            main,\n            thumb\n        } = this.refs;\n\n        let {\n            direction,\n            position,\n            thumbSize\n        } = this.props;\n\n        let isVertical = direction === 'vertical';\n        let axis = isVertical ? 'top' : 'left';\n        this.barSize = main[isVertical ? 'offsetHeight' : 'offsetWidth'] - thumbSize - 4;\n        thumb.style[isVertical ? 'height' : 'width'] = thumbSize + 'px';\n        thumb.style[axis] = Math.round(position * this.barSize) + 'px';\n\n    }\n\n    getMousePosition(e, isVertical) {\n        if (isVertical) {\n            return e.pageY || e.clientY;\n        }\n        return e.pageX || e.clientX;\n    }\n\n    clearTimer() {\n        if (this.timer) {\n            clearTimeout(this.timer);\n            this.timer = null;\n            this.removeStateShow.cancel();\n        }\n    }\n\n    removeStateShow() {\n        this.clearTimer();\n        this.timer = setTimeout(() => {\n            dom.removeClass(this.refs.main, 'state-show');\n        }, 1800);\n    }\n\n    /**\n     * 点击滚动轨道触发\n     *\n     * @param  {Object} e MouseEvent\n     */\n    onBarMouseDown(e) {\n        let target = e.target;\n\n        if (target === this.refs.thumb) {\n            return;\n        }\n\n        let {\n            direction,\n            thumbSize\n        } = this.props;\n\n        let main = this.refs.main;\n\n        let me = this;\n        let isVertical = direction === 'vertical';\n        let axis = isVertical ? 'top' : 'left';\n\n        let barSize = main[isVertical ? 'offsetHeight' : 'offsetWidth'] - thumbSize - 4;\n        let mousePos = this.getMousePosition(e, isVertical) - dom.getPosition(main)[axis];\n\n        let pos = mousePos - thumbSize / 2;\n\n        pos = pos > barSize ? barSize : pos;\n        pos = pos < 0 ? 0 : pos;\n        me.fireAction('change', pos / barSize);\n\n        e.preventDefault();\n    }\n\n    onMouseDown(e) {\n        let body = document.body;\n        dom.addClass(body, 'ui-noselect');\n\n        let isVertical = this.props.direction === 'vertical';\n        let axis = isVertical ? 'top' : 'left';\n\n        this.thumbStart = parseInt(this.refs.thumb.style[axis], 10) || 0;\n        this.moveStart = this.getMousePosition(e, isVertical);\n\n        body.addEventListener('mousemove', this.onMouseMove);\n        body.addEventListener('mouseup', this.onMouseUp);\n\n        e.preventDefault();\n    }\n\n    onMouseMove(e) {\n        e = e || window.event;\n        let isVertical = this.props.direction === 'vertical';\n\n        let moveLength = this.getMousePosition(e, isVertical);\n        moveLength -= this.moveStart;\n\n        let pos = Math.min(this.barSize, Math.max(0, this.thumbStart + moveLength));\n        this.fireAction('change', pos / this.barSize);\n    }\n\n    onMouseUp(e) {\n        let body = document.body;\n        dom.removeClass(body, 'ui-noselect');\n        body.removeEventListener('mousemove', this.onMouseMove);\n        body.removeEventListener('mouseup', this.onMouseUp);\n        this.thumbStart = this.moveStart = 0;\n    }\n\n    fireAction(action, pos) {\n        let e = {\n            action: action,\n            position: pos,\n            target: this\n        };\n\n        let onAction = this.props.onAction;\n\n        onAction && onAction(e);\n    }\n\n    render() {\n\n        return (\n            <div\n                ref=\"main\"\n                className={cx(this.props).addVariants(this.props.direction).build()}\n                onMouseDown={this.onBarMouseDown}>\n                <div\n                    ref=\"thumb\"\n                    className={cx.getPartClassName('thumb')}\n                    onMouseDown={this.onMouseDown} />\n            </div>\n        );\n\n    }\n\n}\n\nScrollViewBar.displayName = 'ScrollViewBar';\n\nScrollViewBar.propTypes = {\n    direction: PropTypes.oneOf(['vertical', 'horizontal']).isRequired,\n    position: PropTypes.number.isRequired,\n    thumbSize: PropTypes.number,\n    show: PropTypes.bool,\n    onAction: PropTypes.func\n};\n"]}