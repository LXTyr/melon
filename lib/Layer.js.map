{"version":3,"sources":["/src/Layer.js"],"names":["cx","Layer","args","onClickAway","bind","componentDidMount","renderLayer","componentDidUpdate","componentWillUnmount","unmountLayer","e","target","defaultPrevented","props","open","layer","contains","render","useLayerMask","document","createElement","addEventListener","setTimeout","window","className","addVariants","build","body","appendChild","layerContent","removeEventListener","removeChild","getLayer","propTypes","func","bool","isRequired","defaultProps"],"mappings":"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","file":"Layer.js","sourcesContent":["/**\n * @file Layer\n * @author leon <ludafa@outlook.com>\n */\n\nimport {Component, PropTypes} from 'react';\nimport {create} from 'melon-core/classname/cxBuilder';\nimport {\n    unstable_renderSubtreeIntoContainer,\n    unmountComponentAtNode\n} from 'react-dom';\n\nconst cx = create('Layer');\n\nexport default class Layer extends Component {\n\n    constructor(...args) {\n        super(...args);\n        this.onClickAway = this.onClickAway.bind(this);\n    }\n\n    componentDidMount() {\n        this.renderLayer();\n    }\n\n    componentDidUpdate() {\n        this.renderLayer();\n    }\n\n    componentWillUnmount() {\n        this.unmountLayer();\n    }\n\n    onClickAway(e) {\n\n        let {target, defaultPrevented} = e;\n        let {onClickAway, open} = this.props;\n        let layer = this.layer;\n\n        if (defaultPrevented || !open || !layer) {\n            return;\n        }\n\n        if (target === layer || !layer.contains(target)) {\n            onClickAway && onClickAway();\n        }\n\n    }\n\n    renderLayer() {\n\n        let {open, render, useLayerMask} = this.props;\n\n        if (!open) {\n            this.unmountLayer();\n            return;\n        }\n\n        let layer = this.layer;\n\n        if (!layer) {\n\n            layer = this.layer = document.createElement('div');\n\n            // 如果使用一个 div 作为遮罩，那么这里给 div 加 click 绑定\n            if (useLayerMask) {\n                layer.addEventListener('click', this.onClickAway);\n            }\n            // 否则我们给 window 加事件绑定\n            else {\n\n                // 这么干是因为 Layer 通常是被 click 触发展现的\n                // 事件会继续冒泡到 window 上，这样我们这里就会被直接关闭掉\n                // 所以，这里用 setTimeout 做事件绑定\n                setTimeout(() => {\n                    window.addEventListener('click', this.onClickAway);\n                }, 0);\n\n            }\n\n            layer.className = cx(this.props)\n                .addVariants(useLayerMask ? 'mask' : null)\n                .build();\n\n            document.body.appendChild(layer);\n        }\n\n        this.layerContent = unstable_renderSubtreeIntoContainer(\n            this,\n            render(),\n            layer\n        );\n\n    }\n\n    unmountLayer() {\n\n        let layer = this.layer;\n\n        if (!layer) {\n            return;\n        }\n\n        layer.removeEventListener('click', this.onClickAway);\n        window.removeEventListener('click', this.onClickAway);\n\n        unmountComponentAtNode(layer);\n        document.body.removeChild(layer);\n        this.layer = null;\n\n    }\n\n    getLayer() {\n        return this.layer;\n    }\n\n    render() {\n        return null;\n    }\n\n}\n\nLayer.propTypes = {\n    onClickAway: PropTypes.func,\n    open: PropTypes.bool.isRequired,\n    render: PropTypes.func.isRequired,\n    useLayerMask: PropTypes.bool.isRequired\n};\n\nLayer.defaultProps = {\n    open: false,\n    useLayerMask: true\n};\n"]}