{"version":3,"sources":["Pager.js"],"names":["cx","Pager","props","page","state","onMainClick","bind","componentWillReceiveProps","nextProps","total","setState","e","preventDefault","target","role","getAttribute","first","onChange","range","start","stop","paddingLeft","paddingRight","renderItem","conf","part","states","lang","useLang","classNames","addStates","build","pageText","ICONS","render","padding","showCount","showAlways","others","className","addVariants","wing","Math","floor","reduceLeftToRight","wingLeft","wingRight","reduceRightToLeft","left","right","result","max","prev","disabled","concat","current","min","next","map","abs","ellipsis","displayName","defaultProps","propTypes","bool","type","string","number","shape"],"mappings":"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","file":"Pager.js","sourcesContent":["/**\n * @file melon/Pager\n * @author cxtom<cxtom2008@gmail.com>\n */\n\nimport React, {Component, PropTypes} from 'react';\nimport Icon from './Icon';\nimport {create} from 'melon-core/classname/cxBuilder';\nimport {range} from 'melon-core/util/array';\n\nconst cx = create('Pager');\n\n/**\n * melon/Pager\n *\n * @extends {React.Component}\n * @class\n */\nexport default class Pager extends Component {\n\n    /**\n     * 构造函数\n     *\n     * @public\n     * @constructor\n     * @param  {*} props 属性\n     */\n    constructor(props) {\n\n        super(props);\n\n        const page = props.page;\n\n        /**\n         * 状态\n         *\n         * @protected\n         * @type {Object}\n         */\n        this.state = {page};\n\n        this.onMainClick = this.onMainClick.bind(this);\n\n    }\n\n    /**\n     * 接受新属性时的处理\n     *\n     * @public\n     * @override\n     * @param {*} nextProps 新属性\n     */\n    componentWillReceiveProps(nextProps) {\n\n        let {page, total} = nextProps;\n\n        if (page < 0) {\n            page = 0;\n        }\n        else if (page > total) {\n            page = total - 1;\n        }\n\n        if (page !== this.state.page) {\n            this.setState({page});\n        }\n    }\n\n    /**\n     * 鼠标移动时的处理\n     *\n     * @protected\n     * @param  {Object} e 事件对象\n     */\n    onMainClick(e) {\n\n        e.preventDefault();\n\n        const target = e.target;\n\n        const role = target.getAttribute('data-role');\n\n        if (role !== 'pager-item') {\n            return;\n        }\n\n        const {first, onChange} = this.props;\n\n        const page = +target.getAttribute('data-page') + first;\n\n        if (this.state.page === page) {\n            return;\n        }\n\n        // 被控制的\n        if (onChange) {\n            onChange({\n                target: this,\n                page: page\n            });\n            return;\n        }\n\n        this.setState({page});\n\n    }\n\n    /**\n     * 生成一个页码数组, 如果需要ellipsis, 那么ellpsis用负数表示它;\n     * 即ellipsis在5号位置, 那么他就是-5\n     * 输入: start 0, stop 10, paddingLeft 3 paddingRight 3\n     * 输出: 0, 1, 2, -3, 8, 9, 10\n     *\n     * @private\n     * @param  {number} start        起始页码\n     * @param  {number} stop         结束页面(不包含)\n     * @param  {number} paddingLeft  起始页码之后, 应展开的页码个数\n     * @param  {number} paddingRight 结束页面之前, 应展开的页码个数\n     * @return {Array<number>}        [start, paddingLeft, .., paddingRight, stop]\n     */\n    range(start, stop, paddingLeft, paddingRight) {\n        return start + paddingLeft < stop - paddingRight\n            ? [\n                ...range(start, start + paddingLeft),\n                -start - paddingLeft,\n                ...range(stop - paddingRight, stop)\n            ]\n            : range(start, stop);\n    }\n\n    /**\n     * 渲染页码\n     *\n     * @protected\n     * @param {Object} conf 页码的属性\n     * @return {ReactElement}\n     */\n    renderItem(conf) {\n\n        const {\n            page,\n            part,\n            states\n        } = conf;\n\n        const {\n            lang,\n            useLang\n        } = this.props;\n\n        const classNames = cx()\n            .part('item')\n            .addStates(states)\n            .build();\n\n        let pageText;\n\n        if (!useLang && part && part !== 'ellipsis') {\n            pageText = (<Icon icon={Pager.ICONS[part]} data-role=\"pager-item\" data-page={page} />);\n        }\n        else {\n            pageText = lang[part] || page + 1;\n        }\n\n        return (\n            <li\n                className={classNames}\n                key={part + page}\n                data-role=\"pager-item\"\n                data-page={page}>\n                {pageText}\n            </li>\n        );\n    }\n\n    /**\n     * 渲染\n     *\n     * @public\n     * @return {ReactElement}\n     */\n    render() {\n\n        const {props, state} = this;\n\n        let {\n            total,\n            first,\n            padding,\n            showCount,\n            useLang,\n            showAlways,\n            ...others\n        } = props;\n\n        let page = state.page;\n\n        showCount = showCount > total ? total : showCount;\n        page = page - first;\n\n        const className = cx(props).addVariants(useLang ? 'lang' : null).build();\n\n        if (!showAlways && total <= 1) {\n            return (\n                <ul\n                    {...others}\n                    className={className}>\n                </ul>\n            );\n        }\n\n        const wing = Math.floor(showCount / 2);\n\n        const paddingLeft = padding;\n        const paddingRight = padding;\n        const reduceLeftToRight = page - wing;\n\n        let wingLeft = wing;\n        let wingRight = wing;\n\n        // 如果wingLeft小于0, 那么把小于0的部分移动到wingRight\n        if (reduceLeftToRight < 0) {\n            wingLeft += reduceLeftToRight;\n            wingRight -= reduceLeftToRight;\n        }\n\n        const reduceRightToLeft = page + wing + 1 - total;\n\n        // 如果wingRight大于total, 那么把超长的部分移动到wingLeft\n        if (reduceRightToLeft > 0) {\n            wingLeft += reduceRightToLeft;\n            wingRight -= reduceRightToLeft;\n        }\n\n        // 生成左半端页码\n        const left = this.range(0, page, paddingLeft, wingLeft);\n        // 生成右半端页码\n        const right = this.range(page + 1, total, wingRight, paddingRight);\n\n        const result = [{\n            page: Math.max(page - 1, 0),\n            states: {\n                prev: true,\n                disabled: page === 0\n            },\n            part: 'prev'\n        }]\n        .concat(left)\n        .concat({\n            page: page,\n            states: {\n                current: true\n            },\n            part: ''\n        })\n        .concat(right)\n        .concat({\n            page: Math.min(page + 1, total - 1),\n            states: {\n                next: true,\n                disabled: page >= total - 1\n            },\n            part: 'next'\n        })\n        .map(conf => {\n\n            if (typeof conf === 'number') {\n                const part = conf >= 0 ? '' : 'ellipsis';\n                conf = {\n                    page: Math.abs(conf),\n                    states: {\n                        ellipsis: !!part\n                    },\n                    part\n                };\n            }\n\n            return this.renderItem(conf);\n\n        });\n\n        return (\n            <ul\n                {...others}\n                className={className}\n                onClick={this.onMainClick}>\n                {result}\n            </ul>\n        );\n\n    }\n\n}\n\nPager.displayName = 'Pager';\n\nPager.defaultProps = {\n\n    // 当前页，第一页从0开始\n    page: 0,\n\n    // 起始页码\n    first: 0,\n\n    // 首尾显示的页码个数\n    padding: 1,\n\n    // 是否一直显示分页控件\n    showAlways: false,\n\n    // 当页数较多时，中间显示页码的个数\n    showCount: 5,\n\n    // 总页数\n    total: 0,\n\n    // 是否可用\n    disabled: false,\n\n    useLang: false,\n\n    // 上下页显示文字\n    lang: {\n\n        // 上一页显示文字\n        prev: '上一页',\n\n        // 下一页显示文字\n        next: '下一页',\n\n        // 省略号\n        ellipsis: '...'\n    }\n};\n\nPager.propTypes = {\n    disabled: PropTypes.bool,\n    type: PropTypes.string,\n    page: PropTypes.number,\n    first: PropTypes.number,\n    padding: PropTypes.number,\n    showAlways: PropTypes.bool,\n    showCount: PropTypes.number,\n    total: PropTypes.number,\n    useLang: PropTypes.bool,\n    lang: PropTypes.shape({\n        prev: PropTypes.string,\n        ellipsis: PropTypes.string,\n        next: PropTypes.string\n    })\n};\n\nPager.ICONS = {\n    prev: 'navigate-before',\n    next: 'navigate-next'\n};\n"]}