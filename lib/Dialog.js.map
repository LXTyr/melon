{"version":3,"sources":["Dialog.js"],"names":["dom","cx","Dialog","props","context","originalHTMLBodySize","state","open","onShow","bind","onHide","onMaskClick","renderLayer","onMotionEnd","componentDidMount","positionDialog","componentDidUpdate","componentWillReceiveProps","nextProps","setState","closing","hide","dialogWindow","findDOMNode","marginTop","offsetHeight","windowHeight","getClientHeight","style","e","maskClickClose","stopPropagation","renderTitle","title","part","build","renderAction","actions","children","width","body","footer","windowPartClassName","addVariants","undefined","className","addStates","opening","distance","yBegin","yEnd","opacityBegin","opacityEnd","control","stiffness","damping","precision","overflow","top","opacity","c","transform","Math","round","render","displayName","propTypes","node","bool","func","oneOfType","string","element","number","defaultProps"],"mappings":"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","file":"Dialog.js","sourcesContent":["/**\n * @file melon/Dialog\n * @author cxtom<cxtom2008@gmail.com>\n */\n\nimport React, {Component, PropTypes} from 'react';\nimport ReactDOM from 'react-dom';\nimport Mask from './Mask';\nimport * as dom from './common/util/dom';\nimport DialogWindow from './dialog/DialogWindow';\nimport Layer from './Layer';\nimport {create} from 'melon-core/classname/cxBuilder';\n\nimport {Motion, spring} from 'react-motion';\n\nconst cx = create('Dialog');\n\n/**\n * melon/Dialog\n *\n * @extends {React.Component}\n * @class\n */\nexport default class Dialog extends Component {\n\n    /**\n     * 构造函数\n     *\n     * @public\n     * @constructor\n     * @param {*} props 属性\n     * @param {*} context 上下文\n     */\n    constructor(props, context) {\n\n        super(props, context);\n\n        /**\n         * 保存原始的 html body 样式\n         *\n         * @private\n         * @type {Object}\n         */\n        this.originalHTMLBodySize = {};\n\n        /**\n         * 初始状态\n         *\n         * @private\n         * @type {Object}\n         */\n        this.state = {\n            open: props.open\n        };\n\n        this.onShow = this.onShow.bind(this);\n        this.onHide = this.onHide.bind(this);\n        this.onMaskClick = this.onMaskClick.bind(this);\n        this.renderLayer = this.renderLayer.bind(this);\n        this.onMotionEnd = this.onMotionEnd.bind(this);\n\n    }\n\n    /**\n     * Mount时的处理\n     *\n     * @public\n     * @override\n     */\n    componentDidMount() {\n        if (this.state.open) {\n            this.positionDialog();\n        }\n    }\n\n    /**\n     * 状态更新时的处理\n     *\n     * @public\n     * @override\n     */\n    componentDidUpdate() {\n        if (this.state.open) {\n            this.positionDialog();\n        }\n    }\n\n    /**\n     * 接受新属性时的处理\n     *\n     * @public\n     * @override\n     * @param {Object} nextProps 新属性\n     */\n    componentWillReceiveProps(nextProps) {\n\n        const open = nextProps.open;\n\n        if (open === this.state.open) {\n            return;\n        }\n\n        // 如果是打开，那么就直接打开。\n        if (open) {\n            this.setState({open: true});\n            return;\n        }\n\n        // 如果是关闭，但我们正在关闭，就算了。\n        if (!this.state.closing) {\n            this.hide();\n        }\n\n    }\n\n    /**\n     * 定位对话框\n     *\n     * @protected\n     */\n    positionDialog() {\n\n        let dialogWindow = this.dialogWindow;\n\n        if (!dialogWindow) {\n            return;\n        }\n\n        dialogWindow = ReactDOM.findDOMNode(this.dialogWindow);\n\n        if (this.state.open) {\n            let marginTop = -dialogWindow.offsetHeight / 2;\n            let windowHeight = dom.getClientHeight();\n\n            marginTop = dialogWindow.offsetHeight > windowHeight\n            ? (-windowHeight / 2 + 16)\n            : marginTop;\n\n            dialogWindow.style.marginTop = marginTop + 'px';\n        }\n        else {\n            dialogWindow.style.marginTop = 0;\n        }\n\n\n    }\n\n    /**\n     * 遮罩点击事件处理\n     *\n     * @protected\n     * @param  {Object} e 事件对象\n     */\n    onMaskClick(e) {\n\n        if (this.props.maskClickClose) {\n            this.hide();\n        }\n        else {\n            e.stopPropagation();\n        }\n\n    }\n\n    /**\n     * 显示事件处理\n     *\n     * @protected\n     */\n    onShow() {\n        const onShow = this.props.onShow;\n        if (onShow) {\n            onShow();\n        }\n    }\n\n    /**\n     * 隐藏事件处理\n     *\n     * @protected\n     */\n    onHide() {\n        const onHide = this.props.onHide;\n        if (onHide) {\n            onHide();\n        }\n    }\n\n    /**\n     * 当动画完成时回调\n     */\n    onMotionEnd() {\n\n        if (this.state.closing) {\n\n            this.setState({\n                closing: false,\n                open: false\n            });\n\n            let onHide = this.props.onHide;\n\n            if (onHide) {\n                onHide();\n            }\n\n        }\n\n    }\n\n    /**\n     * 关闭窗口\n     */\n    hide() {\n\n        let {open, closing} = this.state;\n\n        if (!open || closing) {\n            return;\n        }\n\n        this.setState({closing: true});\n\n    }\n\n    /**\n     * 获取标题\n     *\n     * @protected\n     * @return {ReactElement|null} [description]\n     */\n    renderTitle() {\n\n        const title = this.props.title;\n\n        return title\n            ? <h1 className={cx().part('title').build()}>{title}</h1>\n            : null;\n\n    }\n\n    /**\n     * 获取按钮\n     *\n     * @protected\n     * @return {ReactElement|null} [description]\n     */\n    renderAction() {\n\n        const actions = this.props.actions;\n\n        return actions\n            ? (\n                <div className={cx().part('actions').build()}>\n                    {actions}\n                </div>\n            )\n            : null;\n\n    }\n\n    /**\n     * 渲染内容\n     *\n     * @return {ReactElement}\n     */\n    renderLayer() {\n\n        const {props, state} = this;\n\n        const {\n            children,\n            width\n        } = props;\n\n        const {open, closing} = state;\n\n        const title = this.renderTitle();\n\n        const body = (\n            <div className={cx().part('body').build()}>\n                {children}\n            </div>\n        );\n\n        const footer = this.renderAction();\n\n        const windowPartClassName = cx()\n            .part('window')\n            .addVariants(width === 'adaptive' ? 'adaptive' : undefined)\n            .build();\n\n        const className = cx(props).addStates({open}).build();\n\n        const opening = open && !closing;\n\n        const distance = dom.getClientHeight() * 0.4 * (opening ? -1 : 1);\n        const yBegin = opening ? distance : 0;\n        const yEnd = opening ? 0 : distance;\n        const opacityBegin = opening ? 0 : 1;\n        const opacityEnd = opening ? 1 : 0;\n        const control = {stiffness: 200, damping: 18, precision: 1};\n\n        return (\n            <div className={className} style={!opening ? {overflow: 'hidden'} : null}>\n                <Motion\n                    defaultStyle={{\n                        top: yBegin,\n                        opacity: opacityBegin\n                    }}\n                    style={{\n                        top: spring(yEnd, control),\n                        opacity: spring(opacityEnd, control)\n                    }}\n                    onRest={this.onMotionEnd()}>\n                    {({top, opacity}) => (\n                        <DialogWindow\n                           ref={c => {\n                               this.dialogWindow = c;\n                           }}\n                           width={width}\n                           title={title}\n                           footer={footer}\n                           className={windowPartClassName}\n                           style={{\n                               opacity: opacity,\n                               transform: `translate(-50%, ${Math.round(top)}px)`\n                           }}>\n                           {body}\n                       </DialogWindow>\n                   )}\n                </Motion>\n                <Mask\n                    show={open}\n                    lockScrollingOnShow={true}\n                    onClick={this.onMaskClick} />\n            </div>\n        );\n    }\n\n    /**\n     * 渲染\n     *\n     * @public\n     * @return {ReactElement}\n     */\n    render() {\n        let {open, closing} = this.state;\n        return (\n            <Layer\n                open={open || closing}\n                render={this.renderLayer} />\n        );\n    }\n\n}\n\nDialog.displayName = 'Dialog';\n\n/**\n * propTypes\n *\n * @property {Array<ReactElement>} selectedIndex  选中标签的序号\n * @property {boolean}             maskClickClose 是否点击遮罩时隐藏对话框\n * @property {boolean}             open           是否显示\n * @property {Function}            onHide         隐藏时执行\n * @property {Function}            onShow         显示时执行\n * @property {ReactElement|string} title          标题\n * @property {number|string}       width          对话框宽度\n */\nDialog.propTypes = {\n    actions: PropTypes.node,\n    maskClickClose: PropTypes.bool,\n    open: PropTypes.bool,\n    onHide: PropTypes.func,\n    onShow: PropTypes.func,\n    title: PropTypes.oneOfType([\n        PropTypes.string,\n        PropTypes.element\n    ]),\n    width: PropTypes.oneOfType([\n        PropTypes.string,\n        PropTypes.number\n    ])\n};\n\nDialog.defaultProps = {\n    maskClickClose: true,\n    open: false\n};\n"]}