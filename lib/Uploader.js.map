{"version":3,"sources":["Uploader.js"],"names":["cx","Uploader","props","context","state","isUploading","isUploaded","value","onFileChange","e","setUploading","upload","event","target","files","then","setFile","result","clearFile","componentWillReceiveProps","nextProps","setState","onChange","type","renderUploadFile","part","build","accept","renderUploadButton","size","placeholder","getPartClassName","refs","file","click","render","name","style","className","addStates","getStyleStates","validity","displayName","propTypes","string","func","isRequired","defaultProps","childContextTypes","contextTypes"],"mappings":"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","file":"Uploader.js","sourcesContent":["/**\n * @file melon/Uploader\n * @author leon(ludafa@outlook.com)\n */\n\nimport React, {PropTypes} from 'react';\nimport Button from './Button';\nimport Icon from './Icon';\nimport Progress from './Progress';\nimport Link from './Link';\nimport Validity from 'melon-core/Validity';\nimport InputComponent from 'melon-core/InputComponent';\n\nimport {create} from 'melon-core/classname/cxBuilder';\n\nconst cx = create('Uploader');\n\n/**\n * melon/Uploader\n *\n * @extends {melon-core/InputComponent}\n * @class\n */\nexport default class Uploader extends InputComponent {\n\n    /**\n     * 构造函数\n     *\n     * @public\n     * @constructor\n     * @param  {*} props   属性\n     * @param  {*} context 上下文\n     */\n    constructor(props, context) {\n\n        super(props, context);\n\n        /**\n         * 状态\n         *\n         * @protected\n         * @type {Object}\n         */\n        this.state = {\n            ...this.state,\n            isUploading: false,\n            isUploaded: !!this.props.value\n        };\n\n    }\n\n    /**\n     * 文件上传时的处理\n     *\n     * @protected\n     * @param  {Object} e 事件对象\n     */\n    onFileChange(e) {\n\n        this.setUploading();\n\n        const upload = this.props.upload;\n\n        const event = {\n            target: this,\n            files: e.target.files\n        };\n\n        upload(event).then(\n            result => this.setFile(result),\n            error => this.clearFile()\n        );\n\n    }\n\n    componentWillReceiveProps(nextProps) {\n\n        const value = nextProps.value;\n\n        super.componentWillReceiveProps(nextProps);\n\n        if (value) {\n            this.setState({\n                isUploaded: true,\n                isUploading: false,\n                value\n            });\n            return;\n        }\n\n        this.setState({\n            isUploaded: false,\n            value\n        });\n\n    }\n\n    /**\n     * 设置正在上传的状态\n     *\n     * @public\n     */\n    setUploading() {\n        this.setState({\n            isUploading: true\n        });\n    }\n\n    /**\n     * 设置上传完毕以后的文件地址\n     *\n     * @public\n     * @param {string} value 文件地址\n     */\n    setFile(value) {\n\n        this.setState({\n            isUploaded: true,\n            isUploading: false,\n            value\n        });\n\n        super.onChange({\n            type: 'change',\n            target: this,\n            value\n        });\n\n\n    }\n\n    /**\n     * 重置上传的文件\n     *\n     * @public\n     */\n    clearFile() {\n\n        this.setState({\n            isUploaded: false,\n            isUploading: false,\n            value: ''\n        });\n\n\n        super.onChange({\n            type: 'change',\n            target: this,\n            value: ''\n        });\n\n\n    }\n\n    /**\n     * 渲染input\n     *\n     * @protected\n     * @return {ReactElement?}\n     */\n    renderUploadFile() {\n\n        const {isUploading, isUploaded} = this.state;\n\n        return isUploading || isUploaded\n            ? null\n            : (\n                <input\n                    ref=\"file\"\n                    type=\"file\"\n                    className={cx().part('file').build()}\n                    onChange={e => {\n                        this.onFileChange(e);\n                    }}\n                    accept={this.props.accept} />\n            );\n\n    }\n\n    /**\n     * 渲染按钮\n     *\n     * @protected\n     * @return {ReactElement}\n     */\n    renderUploadButton() {\n\n        const {isUploading, isUploaded, value} = this.state;\n        const {size, placeholder} = this.props;\n\n        if (isUploading) {\n            return (\n                <Progress\n                    size={size}\n                    mode=\"indeterminate\"\n                    shape=\"circle\" />\n            );\n        }\n\n        if (isUploaded) {\n\n            return (\n                <div className={cx.getPartClassName('content')}>\n                    <image\n                        className={cx.getPartClassName('preview')}\n                        src={value} />\n                    <Link\n                        size={size}\n                        href={value}\n                        title=\"点击查看\"\n                        target=\"_blank\">\n                        {value}\n                    </Link>\n                    <Button\n                        size={size}\n                        type=\"button\"\n                        title=\"重新选择\"\n                        onClick={() => {\n                            this.clearFile();\n                        }} >\n                        <Icon icon=\"refresh\" />\n                    </Button>\n                </div>\n            );\n        }\n\n        return (\n            <div\n                className={cx.getPartClassName('content')}\n                onClick={() => {\n                    this.refs.file.click();\n                }}>\n                <Icon icon=\"file-upload\" />\n                <span className={cx.getPartClassName('placeholder')}>\n                    {placeholder}\n                </span>\n            </div>\n        );\n\n    }\n\n    /**\n     * 渲染\n     *\n     * @public\n     * @return {ReactElement}\n     */\n    render() {\n\n        const props = this.props;\n        const {value, name, style} = props;\n        const className = cx(props).addStates(this.getStyleStates()).build();\n\n        return (\n            <div\n                className={className}\n                style={style}>\n                <input name={name} type=\"hidden\" value={value} />\n                {this.renderUploadFile()}\n                {this.renderUploadButton()}\n                <Validity validity={this.state.validity} />\n            </div>\n        );\n\n    }\n\n}\n\nUploader.displayName = 'Uploader';\n\nUploader.propTypes = {\n    ...InputComponent.propTypes,\n    accept: PropTypes.string,\n    upload: PropTypes.func.isRequired,\n    placeholder: PropTypes.string\n};\n\nUploader.defaultProps = {\n    ...InputComponent.defaultProps,\n    placeholder: '点击上传'\n};\n\nUploader.childContextTypes = InputComponent.childContextTypes;\nUploader.contextTypes = InputComponent.contextTypes;\n"]}