{"version":3,"sources":["Tooltip.js"],"names":["cx","Tooltip","props","onClick","bind","onMouseEnter","onMouseLeave","state","isShown","componentDidMount","popup","createPopup","renderPopup","content","componentWillUnmount","destroyPopup","componentDidUpdate","e","toggle","show","hide","setState","getPosition","main","left","top","opacity","width","height","direction","offsetX","offsetY","childNodes","position","offsetWidth","offsetHeight","styles","target","render","part","build","mode","children","style","addStates","displayName","propTypes","arrow","bool","isRequired","oneOf","node","defaultProps","container","document","createElement","className","body","appendChild","unmountComponentAtNode","removeChild"],"mappings":"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","file":"Tooltip.js","sourcesContent":["/**\n * @file melon/Tooltip\n * @author leon(ludafa@outlook.com)\n */\n\nimport React, {Component, PropTypes} from 'react';\nimport ReactDOM from 'react-dom';\nimport dom from './common/util/dom';\nimport {create} from 'melon-core/classname/cxBuilder';\n\nconst cx = create('Tooltip');\n\n/**\n * melon/Tooltip\n *\n * @extends {React.Component}\n * @class\n */\nexport default class Tooltip extends Component {\n\n    /**\n     * 构造函数\n     *\n     * @public\n     * @constructor\n     * @param  {*} props   属性\n     */\n    constructor(props) {\n\n        super(props);\n\n        this.onClick = this.onClick.bind(this);\n        this.onMouseEnter = this.onMouseEnter.bind(this);\n        this.onMouseLeave = this.onMouseLeave.bind(this);\n\n        /**\n         * 状态\n         *\n         * @protected\n         * @type {Object}\n         */\n        this.state = {\n            isShown: false\n        };\n\n    }\n\n    /**\n     * 将要Mount时的处理\n     *\n     * @public\n     * @override\n     */\n    componentDidMount() {\n        const popup = this.popup = Tooltip.createPopup();\n        this.renderPopup(popup, this.props.content);\n    }\n\n    /**\n     * 将要Unmount时的处理\n     *\n     * @public\n     * @override\n     */\n    componentWillUnmount() {\n        Tooltip.destroyPopup(this.popup);\n\n        /**\n         * 弹出层的dom\n         *\n         * @protected\n         * @type {HTMLElement}\n         */\n        this.popup = null;\n    }\n\n    /**\n     * 状态更新时的处理\n     *\n     * @public\n     * @override\n     */\n    componentDidUpdate() {\n        this.renderPopup(this.popup, this.props.content);\n    }\n\n    /**\n     * 点击时的处理\n     *\n     * @protected\n     * @param  {Object} e 事件对象\n     */\n    onClick(e) {\n        this.toggle();\n    }\n\n    /**\n     * 鼠标进入时的处理\n     *\n     * @protected\n     * @param  {Object} e 事件对象\n     */\n    onMouseEnter(e) {\n        this.show();\n    }\n\n    /**\n     * 点击离开的处理\n     *\n     * @protected\n     * @param  {Object} e 事件对象\n     */\n    onMouseLeave(e) {\n        this.hide();\n    }\n\n    /**\n     * 当前是否显示\n     *\n     * @public\n     * @return {boolean}\n     */\n    isShown() {\n        return this.state.isShown;\n    }\n\n    /**\n     * 改变当前显示状态\n     *\n     * @public\n     */\n    toggle() {\n        this.isShown() ? this.hide() : this.show();\n    }\n\n    /**\n     * 显示tip\n     *\n     * @public\n     */\n    show() {\n        this.setState({isShown: true});\n    }\n\n    /**\n     * 隐藏tip\n     *\n     * @public\n     */\n    hide() {\n        this.setState({isShown: false});\n    }\n\n    /**\n     * 获取位置的样式\n     *\n     * @protected\n     * @return {Object}\n     */\n    getPosition() {\n\n        const main = this.main;\n\n        if (!this.isShown() || !main) {\n            return {\n                left: -10000,\n                top: 0,\n                opacity: 0,\n                width: 'auto',\n                height: 'auto'\n            };\n        }\n\n        const props = this.props;\n\n        const {\n            direction,\n            offsetX,\n            offsetY\n        } = props;\n\n        const popup = this.popup.childNodes[0];\n\n        const position = dom.getPosition(main);\n\n        const {offsetWidth, offsetHeight} = popup;\n\n        const styles = {opacity: 1};\n\n        switch (direction) {\n            case 'top':\n                styles.left = position.left + (position.width - offsetWidth) / 2;\n                styles.top = position.top - offsetHeight - offsetY;\n                break;\n            case 'bottom':\n                styles.left = (position.width - offsetWidth) / 2 + position.left;\n                styles.top = position.top + position.height + offsetY;\n                break;\n            case 'left':\n                styles.top = (position.height - offsetHeight) / 2 + position.top;\n                styles.left = position.left - offsetWidth - offsetY;\n                break;\n            case 'right':\n                styles.top = (position.height - offsetHeight) / 2 + position.top;\n                styles.left = position.left + position.width + offsetX;\n                break;\n        }\n\n        return styles;\n\n    }\n\n    /**\n     * 渲染弹出层\n     *\n     * @protected\n     * @param  {HTMLElement} target  目标dom\n     * @param  {string|ReactElement} content 内容\n     */\n    renderPopup(target, content) {\n\n        ReactDOM.render(\n            <div\n                className={cx().part('popup').build()}\n                style={this.getPosition()}>\n                {content}\n            </div>,\n            target\n        );\n\n    }\n\n    /**\n     * 渲染\n     *\n     * @public\n     * @return {ReactElement}\n     */\n    render() {\n\n        const props = this.props;\n\n        const {\n            mode,\n            direction,\n            children,\n            style\n        } = props;\n\n        const onClick = mode === 'click' ? this.onClick : null;\n        const onMouseEnter = mode === 'over' ? this.onMouseEnter : null;\n        const onMouseLeave = mode === 'over' ? this.onMouseLeave : null;\n\n        return (\n            <div\n                ref={main => {\n                    if (main) {\n                        this.main = main;\n                    }\n                }}\n                style={style}\n                className={cx(props).addStates({direction}).build()}\n                onClick={onClick}\n                onMouseEnter={onMouseEnter}\n                onMouseLeave={onMouseLeave}>\n                {children}\n            </div>\n        );\n    }\n\n}\n\nTooltip.displayName = 'Tooltip';\n\nTooltip.propTypes = {\n    arrow: PropTypes.bool.isRequired,\n    direction: PropTypes.oneOf(['top', 'bottom', 'left', 'right']).isRequired,\n    mode: PropTypes.oneOf(['over', 'click']),\n    content: PropTypes.node.isRequired\n};\n\nTooltip.defaultProps = {\n    arrow: true,\n    direction: 'bottom',\n    mode: 'over',\n    offsetX: 14,\n    offsetY: 14\n};\n\n(function () {\n\n    let container;\n\n    Tooltip.createPopup = function () {\n\n        if (!container) {\n            container = document.createElement('div');\n            container.className = cx().part('container').build();\n            document.body.appendChild(container);\n        }\n\n        const popup = document.createElement('div');\n\n        container.appendChild(popup);\n\n        return popup;\n\n    };\n\n    Tooltip.destroyPopup = function (popup) {\n        ReactDOM.unmountComponentAtNode(popup);\n        container.removeChild(popup);\n    };\n\n})();\n"]}