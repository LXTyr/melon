/*! 2016 Baidu Inc. All Rights Reserved */
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","react","./scrollview/Bar","./common/util/cxBuilder","./babelHelpers"],t);else if("undefined"!=typeof exports)t(exports,require("react"),require("./scrollview/Bar"),require("./common/util/cxBuilder"),require("./babelHelpers"));else{var r={exports:{}};t(r.exports,e.react,e.Bar,e.cxBuilder,e.babelHelpers),e.ScrollView=r.exports}}(this,function(exports,e,t,r,i){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var o=i.interopRequireDefault(e),n=i.interopRequireDefault(t),a=r.create("scrollview"),s={vertical:"deltaY",horizontal:"deltaX"},l={vertical:"offsetHeight",horizontal:"offsetWidth"},u=function(e){function t(r){i.classCallCheck(this,t);var o=i.possibleConstructorReturn(this,e.call(this,r));return o.thumbSize={vertical:0,horizontal:0},o.timer=null,o.onWheel=o.onWheel.bind(o),o.state={position:{vertical:0,horizontal:0}},o}return i.inherits(t,e),t.prototype.componentDidMount=function(){this.updateContentSize(),this.setState({position:{vertical:0,horizontal:0}})},t.prototype.componentDidUpdate=function(){this.updateContentSize()},t.prototype.updateContentSize=function(){var e=this,t=this.refs,r=t.main,i=t.content,o=this.state.position;this.getDirections().forEach(function(t){var n=i[l[t]],a=r[l[t]];e.thumbSize[t]=a===n?0:Math.round(a*a/n);var s=Math.round(o[t]*n*(1-a/n));i.style["vertical"===t?"top":"left"]=-s+"px"})},t.prototype.onAction=function(e,t){var r=t.action,i=t.position;switch(r){case"change":var o={};o[e]=i,this.setScrollPercent(o)}},t.prototype.onWheel=function(e){var t=this.getDirections(),r=this.props.wheelSpeed,i=this.state.position;if(t.forEach(function(t){i[t]+=e[s[t]]*r;var o=i[t];if(o>=.005&&.995>=o)e.preventDefault()}),this.setScrollPercent(i),2===t.length)e.preventDefault()},t.prototype.setScrollPercent=function(e){var t=this.state.position;Object.keys(e).forEach(function(r){var i=e[r];if(.005>i)i=0;else if(.005>1-i)i=1;t[r]=i}),this.setState({position:t},function(){var e=this.props.onScroll;e&&e({position:t,target:this})})},t.prototype.getDirections=function(){var e=this.props.direction,t="both"===e?Object.keys(s):[e];return t},t.prototype.renderScrollBar=function(){var e=this,t=this.getDirections(),r=this.state.position;return t.map(function(t,i){var a=e.thumbSize[t];if(a)return o["default"].createElement(n["default"],{key:t,thumbSize:a,onAction:e.onAction.bind(e,t),position:r[t],direction:t})})},t.prototype.render=function(){var e=this.props,t=e.children,r=e.others,n=e.height,s=e.width;return o["default"].createElement("div",i["extends"]({},r,{className:a(this.props).addVariants(this.getDirections()).build(),style:{height:n,width:s},onWheel:this.onWheel,ref:"main"}),this.renderScrollBar(),o["default"].createElement("div",{ref:"content",className:a().part("main").build()},t))},t}(e.Component);exports["default"]=u,u.displayName="ScrollView",u.propTypes={direction:e.PropTypes.oneOf(["vertical","horizontal","both"]),wheelSpeed:e.PropTypes.number,onScroll:e.PropTypes.func},u.defaultProps={direction:"vertical",wheelSpeed:.005}});