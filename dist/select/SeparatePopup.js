/*! 2016 Baidu Inc. All Rights Reserved */
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","react","react-motion","../common/util/dom","../common/util/cxBuilder","../babelHelpers"],t);else if("undefined"!=typeof exports)t(exports,require("react"),require("react-motion"),require("../common/util/dom"),require("../common/util/cxBuilder"),require("../babelHelpers"));else{var r={exports:{}};t(r.exports,e.react,e.reactMotion,e.dom,e.cxBuilder,e.babelHelpers),e.SeparatePopup=r.exports}}(this,function(exports,e,t,r,i,o){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=o.interopRequireDefault(e),a=o.interopRequireDefault(r),s=i.create("SeparatePopup"),l=function(e){function r(t){o.classCallCheck(this,r);var i=o.possibleConstructorReturn(this,e.call(this,t));return i.onWindowResize=function(){var e=i.onWindowResize;return function(){clearTimeout(i.windowResizeTimer),i.windowResizeTimer=setTimeout(e,500)}}(),i.id=Date.now(),i.state={styles:{top:0,left:-5e3,height:0,opacity:0,width:0}},i.onClick=i.onClick.bind(i),i.onWindowResize=i.onWindowResize.bind(i),i}return o.inherits(r,e),r.prototype.componentDidMount=function(){a["default"].on(document.body,"click",this.onClick)},r.prototype.componentWillReceiveProps=function(e){var t=e.open;a["default"][t?"on":"off"](window,"resize",this.onWindowResize),this.setState(o["extends"]({},this.state,{styles:this.getStyle(t)}))},r.prototype.componentWillUnmount=function(){a["default"].off(window,"resize",this.onWindowResize),a["default"].off(document.body,"click",this.onClick)},r.prototype.getStyle=function(e){if(!e)return o["extends"]({},this.state.styles,{height:0,opacity:0});var t=this.props.target,r=this.main,i=a["default"].getPosition(t),n=r.style,s=n.top,l=n.left,u=n.width,p=n.height,c=n.overflow;r.style.top="0",r.style.left="-5000px",r.style.overflow="visible",r.style.height="auto",r.style.width="auto";var d=a["default"].getPosition(r);r.style.top=s,r.style.left=l,r.style.overflow=c,r.style.height=p,r.style.width=u;var f=a["default"].getScrollTop(),h=a["default"].getScrollLeft(),m=a["default"].getClientWidth(),y=a["default"].getClientHeight(),b=void 0,v=void 0;if(i.top+d.height<f+y)b=i.top;else b=y+f-d.height-20;if(i.left+d.width<m+h)v=i.left;else v=m+h-d.width-20;return{opacity:1,top:b,left:v,height:d.height,width:Math.max(i.width,d.width)}},r.prototype.onClick=function(e){var t=e.target,r=this.main,i=this.props,o=i.onHide,n=i.open;if(n&&r!==t&&!a["default"].contains(r,t))o&&o()},r.prototype.onWindowResize=function(){this.setState(o["extends"]({},this.state,{styles:this.getStyle(!0)}))},r.prototype.render=function(){var e=this,r=this.props.children,i=s(this.props).build(),a=s().part("content").build(),l=this.state.styles,u=l.height,p=l.opacity;return n["default"].createElement(t.Motion,{style:o["extends"]({},l,{height:t.spring(u,{stiffness:120,damping:15}),opacity:t.spring(p,{stiffness:120,damping:15})})},function(t){return n["default"].createElement("div",{className:i,style:o["extends"]({},t,{visibility:t.opacity<.1?"hidden":"visible"}),ref:function(t){if(t)e.main=t}},n["default"].createElement("div",{className:a},r))})},r}(e.Component);exports["default"]=l,l.displayName="SelectSeparatePopup",l.propTypes={target:e.PropTypes.object.isRequired,onHide:e.PropTypes.func.isRequired}});