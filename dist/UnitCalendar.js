/*! 2016 Baidu Inc. All Rights Reserved */
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","react","./BoxGroup","./common/util/date","./common/util/cxBuilder","./InputComponent","./babelHelpers"],t);else if("undefined"!=typeof exports)t(exports,require("react"),require("./BoxGroup"),require("./common/util/date"),require("./common/util/cxBuilder"),require("./InputComponent"),require("./babelHelpers"));else{var r={exports:{}};t(r.exports,e.react,e.BoxGroup,e.date,e.cxBuilder,e.InputComponent,e.babelHelpers),e.UnitCalendar=r.exports}}(this,function(exports,e,t,r,o,i,n){"use strict";function a(e,t){if(e=new Date(e),"week"===t)e.setDate(e.getDate()-e.getDay()+1);else if("month"===t)e.setDate(1);else e.setMonth(0),e.setDate(1);return e}function s(e,t){if(e=a(e,t),"week"===t)e.setDate(e.getDate()+7);else if("month"===t)e.setMonth(e.getMonth()+1);else e.setFullYear(e.getFullYear()+1);return e}function l(e,t,r){e=a(e,r);for(var o=[];t>e;)if(o.push(new Date(e)),"week"===r)e.setDate(e.getDate()+7);else if("month"===r)e.setMonth(e.getMonth()+1);else e.setFullYear(e.getFullYear()+1);return o}Object.defineProperty(exports,"__esModule",{value:!0}),exports.normalize=a,exports.getNextTime=s,exports.getContinuousFragments=l;var u=n.interopRequireDefault(e),p=n.interopRequireDefault(t),d=n.interopRequireWildcard(r),c=n.interopRequireDefault(i),f=o.create("UnitCalendar"),h=function(e){function t(r){n.classCallCheck(this,t);var o=n.possibleConstructorReturn(this,e.call(this,r));return o.onChange=o.onChange.bind(o),o}return n.inherits(t,e),t.prototype.onChange=function(e){var t=e.value,r=this.props,o=r.continuous,i=r.value;this.props.onChange({target:this,value:o?this.calculate(i,t).map(this.parse):i})},t.prototype.calculate=function(e,t){e=e.map(this.format).sort(),t=t.sort();var r=e.length,o=t.length,i=this.props.unit;if(r===o)return e;if(!r||!o)return t;if(o>r){var n=new Date(t[0]),a=new Date(e[0]);if(a>n)return l(n,a,i).map(this.format).concat(e);var s=new Date(t[o-1]);s.setDate(s.getDate()+1);var u=new Date(e[r-1]);return e.concat(l(u,s,i).slice(1).map(this.format))}for(var p=0;o>p;++p)if(e[p]<t[p])if(0===p)return e.slice(1);else return e.slice(0,p);return e.slice(0,-1)},t.prototype.parse=function(e){return new Date(e)},t.prototype.format=function(e){return d.format(e,"yyyy-mm-dd")},t.prototype.parseValue=function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return e.split(",").map(function(e){return this.parse(e)})},t.prototype.stringifyValue=function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];return e.map(function(e){return this.format(e)}).join(",")},t.prototype.render=function(){var e=this,t=this.props,r=t.begin,o=t.end,i=t.unit,c=t.value,h=t.format,m=n.objectWithoutProperties(t,["begin","end","unit","value","format"]),y=this.onChange;c=c.map(function(e){return d.format(a(e,i),h)}).sort();var b=l(r,o,i).map(function(t){var r=e.format(t),o=s(t,i);return o.setDate(o.getDate()-1),o=e.format(o),u["default"].createElement("option",{key:r,value:r,label:r+" ~ "+o})});return u["default"].createElement("div",{className:f(this.props).build()},u["default"].createElement(p["default"],n["extends"]({},m,{boxModel:"checkbox",onChange:y,value:c}),b))},t}(c["default"]);exports["default"]=h,h.propTypes={begin:e.PropTypes.instanceOf(Date),end:e.PropTypes.instanceOf(Date),unit:e.PropTypes.oneOf(["week","month","year"]).isRequired,value:e.PropTypes.arrayOf(e.PropTypes.instanceOf(Date)),continuous:e.PropTypes.bool.isRequired,defaultValue:e.PropTypes.arrayOf(e.PropTypes.string)},h.defaultProps={continuous:!0,value:[],defaultValue:[],format:"yyyy-mm-dd"}});