/*! 2016 Baidu Inc. All Rights Reserved */
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","react","./Calendar","./Icon","./Confirm","./calendar/Panel","./Validity","./common/util/cxBuilder","./InputComponent","./common/util/date","./common/util/syncPropsToState","./babelHelpers"],t);else if("undefined"!=typeof exports)t(exports,require("react"),require("./Calendar"),require("./Icon"),require("./Confirm"),require("./calendar/Panel"),require("./Validity"),require("./common/util/cxBuilder"),require("./InputComponent"),require("./common/util/date"),require("./common/util/syncPropsToState"),require("./babelHelpers"));else{var r={exports:{}};t(r.exports,e.react,e.Calendar,e.Icon,e.Confirm,e.Panel,e.Validity,e.cxBuilder,e.InputComponent,e.date,e.syncPropsToState,e.babelHelpers),e.RangeCalendar=r.exports}}(this,function(exports,e,t,r,i,o,n,a,s,l,u,p){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var d=p.interopRequireDefault(e),c=p.interopRequireDefault(t),f=p.interopRequireDefault(r),h=p.interopRequireDefault(i),m=p.interopRequireDefault(o),y=p.interopRequireDefault(n),b=p.interopRequireDefault(s),v=p.interopRequireWildcard(l),x=a.create("RangeCalendar"),g=function(e){function t(r,i){p.classCallCheck(this,t);var o=p.possibleConstructorReturn(this,e.call(this,r,i)),n=r.begin,a=r.end;return o.state=p["extends"]({},o.state,{open:!1,date:o.getNormalizeValue(o.state.value,n,a)}),o.onLabelClick=o.onLabelClick.bind(o),o.onConfirm=o.onConfirm.bind(o),o.onLabelClick=o.onLabelClick.bind(o),o.onCancel=o.onCancel.bind(o),o.onDateChange=o.onDateChange.bind(o),o.formatDate=o.formatDate.bind(o),o}return p.inherits(t,e),t.prototype.componentWillReceiveProps=function(t){var r=t.begin,i=t.end,o=t.value;if(o!==this.state.value)this.setState({date:this.getNormalizeValue(o,r,i)});e.prototype.componentWillReceiveProps.call(this,t)},t.prototype.getSyncUpdates=function(e){var t=e.disabled,r=e.customValidity,i=e.value,o=e.begin,n=e.end,a=i?this.getNormalizeValue(i,o,n):null,s=u.getNextValidity(this,{value:i,disabled:t,customValidity:r});return{date:a,vilidity:s,value:i}},t.prototype.getNormalizeValue=function(e,t,r){if(0===e.length)return e;t=this.parseDate(t),r=this.parseDate(r);var i=this.parseDate(e[0]),o=this.parseDate(e[1]);return e=[i&&v.isAfterDate(t,i)?t:i,o&&v.isBeforeDate(r,o)?r:o]},t.prototype.getValue=function(){var e=this,t=this.props,r=t.begin,i=t.end,o=this.state.value;return this.getNormalizeValue(o,r,i).map(function(t){return e.formatDate(t)})},t.prototype.onLabelClick=function(){var e=this.props,t=e.disabled,r=e.readOnly;if(!t&&!r)this.setState({open:!0})},t.prototype.onCancel=function(){this.setState({open:!1})},t.prototype.onDateChange=function(e,t){var r=t.value,i=[].concat(this.state.date);if(0===i.length)i=[new Date,new Date];i[e]=r,this.setState({date:i,month:i})},t.prototype.onConfirm=function(){var t=this,r=this.state,i=r.date,o=r.value;this.setState({open:!1},function(){if(!v.isEqualDate(i[0],t.parseDate(o[0]))||!v.isEqualDate(i[1],t.parseDate(o[1])))e.prototype.onChange.call(t,{type:"change",target:t,value:i.map(t.formatDate)})})},t.prototype.formatDate=function(e){var t=this.props,r=t.dateFormat,i=t.lang;return v.format(e,r.toLowerCase(),i)},t.prototype.parseDate=function(e){if("string"!=typeof e)return e;var t=this.props.dateFormat.toLowerCase();return v.parse(e,t)},t.prototype.render=function(){var e=this.props,t=e.lang,r=e.disabled,i=e.size,o=(e.dateFormat,e.name),n=e.begin,a=e.end,s=e.validity,l=e.placeholder,u=p.objectWithoutProperties(e,["lang","disabled","size","dateFormat","name","begin","end","validity","placeholder"]),c=this.getValue(),b=this.state,v=b.open,g=b.date;return n=n?this.parseDate(n):null,a=a?this.parseDate(a):null,d["default"].createElement("div",p["extends"]({},u,{className:x(e).addStates({focus:v}).build()}),d["default"].createElement("input",{name:o,ref:"input",type:"hidden",value:c.join(","),disabled:r}),d["default"].createElement("label",{onClick:this.onLabelClick},0===c.length?d["default"].createElement("span",{className:x().part("label-placeholder").build()},l):c[0]+" 至 "+c[1],d["default"].createElement(f["default"],{icon:"expand-more"})),d["default"].createElement(y["default"],{validity:s}),d["default"].createElement(h["default"],{open:v,variants:["calendar"],onConfirm:this.onConfirm,onCancel:this.onCancel,size:i,buttonVariants:["secondery","calendar"]},d["default"].createElement("div",{className:x().part("row").build()},d["default"].createElement(m["default"],{lang:t,date:g[0]||new Date,begin:n,end:g[1]||new Date,onChange:this.onDateChange.bind(this,0)}),d["default"].createElement(m["default"],{lang:t,date:g[1]||new Date,begin:g[0]||new Date,end:a,onChange:this.onDateChange.bind(this,1)}))))},t}(b["default"]);exports["default"]=g,g.displayName="RangeCalendar",g.defaultProps=p["extends"]({},c["default"].defaultProps,{defaultValue:[],placeholder:"请选择"}),g.propTypes=p["extends"]({},c["default"].propTypes,{defaultValue:e.PropTypes.arrayOf(e.PropTypes.string),autoOk:e.PropTypes.bool,dateFormat:e.PropTypes.string,begin:e.PropTypes.oneOfType([e.PropTypes.object,e.PropTypes.string]),end:e.PropTypes.oneOfType([e.PropTypes.object,e.PropTypes.string])})});