/*! 2016 Baidu Inc. All Rights Reserved */
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","react","../common/util/cxBuilder","../common/util/dom","../common/util/fn","../babelHelpers"],t);else if("undefined"!=typeof exports)t(exports,require("react"),require("../common/util/cxBuilder"),require("../common/util/dom"),require("../common/util/fn"),require("../babelHelpers"));else{var r={exports:{}};t(r.exports,e.react,e.cxBuilder,e.dom,e.fn,e.babelHelpers),e.Bar=r.exports}}(this,function(exports,e,t,r,i,o){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=o.interopRequireDefault(e),a=o.interopRequireWildcard(r),s=t.create("ScrollviewBar"),l=function(e){function t(r){o.classCallCheck(this,t);var n=o.possibleConstructorReturn(this,e.call(this,r));return n.removeStateShow=i.throttle(n.removeStateShow.bind(n),100),n.onBarMouseDown=n.onBarMouseDown.bind(n),n.onMouseDown=n.onMouseDown.bind(n),n.onMouseUp=n.onMouseUp.bind(n),n.onMouseMove=n.onMouseMove.bind(n),n.state={},n}return o.inherits(t,e),t.prototype.componentDidMount=function(){this.positionThumb()},t.prototype.shouldComponentUpdate=function(e){if(Math.abs(e.position-this.props.position)<5e-4)return!1;else return a.addClass(this.refs.main,"state-show"),this.removeStateShow(),!0},t.prototype.componentDidUpdate=function(){this.positionThumb()},t.prototype.componentWillUnmount=function(){this.clearTimer()},t.prototype.positionThumb=function(){var e=this.refs,t=e.main,r=e.thumb,i=this.props,o=i.direction,n=i.position,a=i.thumbSize,s="vertical"===o,l=s?"top":"left";this.barSize=t[s?"offsetHeight":"offsetWidth"]-a-4,r.style[s?"height":"width"]=a+"px",r.style[l]=Math.round(n*this.barSize)+"px"},t.prototype.getMousePosition=function(e,t){if(t)return e.pageY||e.clientY;else return e.pageX||e.clientX},t.prototype.clearTimer=function(){if(this.timer)clearTimeout(this.timer)},t.prototype.removeStateShow=function(){this.clearTimer();var e=this.refs.main;this.timer=setTimeout(function(){a.removeClass(e,"state-show")},1800)},t.prototype.onBarMouseDown=function(e){var t=e.target;if(t!==this.refs.thumb){var r=this.props,i=r.direction,o=r.thumbSize,n=this.refs.main,s=this,l="vertical"===i,u=l?"top":"left",p=n[l?"offsetHeight":"offsetWidth"]-o-4,c=this.getMousePosition(e,l)-a.getPosition(n)[u],d=c-o/2;d=d>p?p:d,d=0>d?0:d,s.fireAction("change",d/p),e.preventDefault()}},t.prototype.onMouseDown=function(e){var t=document.body;a.addClass(t,"ui-noselect");var r="vertical"===this.props.direction,i=r?"top":"left";this.thumbStart=parseInt(this.refs.thumb.style[i],10)||0,this.moveStart=this.getMousePosition(e,r),a.on(t,"mousemove",this.onMouseMove),a.on(t,"mouseup",this.onMouseUp),e.preventDefault()},t.prototype.onMouseMove=function(e){e=e||window.event;var t="vertical"===this.props.direction,r=this.getMousePosition(e,t);r-=this.moveStart;var i=Math.min(this.barSize,Math.max(0,this.thumbStart+r));this.fireAction("change",i/this.barSize)},t.prototype.onMouseUp=function(e){var t=document.body;a.removeClass(t,"ui-noselect"),a.off(t,"mousemove",this.onMouseMove),a.off(t,"mouseup",this.onMouseUp),this.thumbStart=this.moveStart=0},t.prototype.fireAction=function(e,t){var r={action:e,position:t,target:this},i=this.props.onAction;i&&i(r)},t.prototype.render=function(){return n["default"].createElement("div",o["extends"]({},this.props,{ref:"main",className:s(this.props).addVariants(this.props.direction).build(),onMouseDown:this.onBarMouseDown}),n["default"].createElement("div",{ref:"thumb",className:s().part("thumb").build(),onMouseDown:this.onMouseDown}))},t}(e.Component);exports["default"]=l,l.displayName="ScrollViewBar",l.propTypes={direction:e.PropTypes.oneOf(["vertical","horizontal"]).isRequired,position:e.PropTypes.number.isRequired,thumbSize:e.PropTypes.number,show:e.PropTypes.bool,onAction:e.PropTypes.func}});